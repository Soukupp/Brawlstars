
# 1	项目信息介绍
## 1.1	项目名：Brawlstars

## 1.2	项目成员： 
                束赫   2151616
                李元特 2150260
                王鹏   2154168

## 1.3	小组成员贡献比例：
                束赫：33%   李元特：33%   王鹏：33%

## 1.4	GitHub地址：
-  [Github地址](https://github.com/Soukupp/Brawlstars.git)

## 1.5	项目进度时间线：
- 5.14 前        学习cocos2d-x相关知识
- 5.14  束赫：传入初始化项目
- 5.16  王鹏：主菜单，主页面框架设计
- 5.17  王鹏：主页面、设置页面设计
- 5.18  李元特：游戏界面、地图、游戏结束界面、音效相关设计
- 5.19  束赫：SettingsScene具体功能实现，包括音量暂停恢复，fps显示
- 5.21  李元特：地图方面改版，增加了MapLayer，专门处理地图，增加了游戏进行中的音量调节界面
- 5.22  李元特：地图改版，键盘功能增加
        束赫：搭建StoreScene和HeroScene框架，增加StoreScene中滑动界面的实现，增加HeroScene英雄界面展示、英雄选定的实现
- 5.23  王鹏：代码整理，包括：代码文件层级整理，resource层级整理，对应文件名路径修改
- 5.24  王鹏：人物的其中一个具体实现，bug修改，人物结构调 整，将血条蓝条拆分到类外
- 5.25  王鹏： Hero2完成，MapLayer的人物创建函数
        李元特：一些地图上的优化（Monster，AI，障碍物等的设置），创建Monster类
- 5.26  束赫：增加UserDefault实现设置的全局调节，微调设置类的成员变量，优化显示布局
        李元特：增加音乐资源，更新地图，增加GameLoading界面
- 5.27  王鹏：人物攻击调用方式修改，宏定义修正；人物武器素材替换，精简某些函数调用
        李元特：实现鼠标按压持续移动，初步设定update相关函数
- 5.28  束赫：HeroScene增加英雄展示动画，并且实现优先展示已选英雄功能；实现HeroScene英雄选择和GameScene的对接, MapLayer英雄移动效果改变，LoadingScene代码优化
- 5.29  李元特：增加了技能按钮、程序设计与素材优化
- 5.31  李元特：增加鼠标点击输出角度函数、在weapon里增加了可能会需要用到的物理碰撞函数，实现玩家进入草丛隐身功能
- 6.2   李元特：整体游戏的细节改善，一部分资源的替换/增加，第二章地图绘制完成，增加了弹窗功能
        王鹏： 增加默认初始化方式，宏完善、增加等级、升级、增加等级展示、人物移动完善、增加hero3 hero4模板，变量名完善
- 6.3   束赫：1.增加人物动画，包括行走动画，攻击动画，普通状态动画，实现鼠标操控攻击动画，键盘操控行走动画，解决Action之间的冲突问题，按键冲突问题；
             2.人物近距离碰撞检测实现，基于此实现是否命中目标攻击音效的不同；
             3.Panel类，Player类，Hero2类（目前测试都基于Hero2）新增变量和成员函数
- 6.4  李元特：毒圈（安全区）功能初步实现，替换部分音效素材
       王鹏：完成人物攻击时造成伤害的结算函数编写、完善遭到伤害的结算、头文件调整
- 6.5  李元特：安全区（毒区）完成，增加功能：传送阵，地图细节优化
- 6.6  王鹏：AI初步实现，包括AI攻击的功能，怪兽头文件完成，解决冲突
       李元特：MapScene实现，菜单指向各界面、LoadingScene细节部分完成，多资源进行了替换。规划后续细节工作
       束赫：碰撞针对不同英雄攻击方式优化，新增英雄不同状态动画，实现HeroScene和Maplayer对接，人物动作衔接优化
- 6.7  束赫：增加人物大招特效，实现三次普攻命中后释放大招，实现AI攻击走动动画，实现AI碰撞效果
       王鹏：通过Character将角色所需指针、数据等统一管理，通过动态数组将Character统一管理，便于遍历与调用
- 6.8  王鹏：怪兽头文件，排名基本实现
       李元特：改进血条bug，对AI的各地出生，安全区，传送阵的AI进行相关处理，弹窗实现
       束赫：基于结构体数组对maplayer相关代码重写，实现AI之间相互攻击，实现人物对各个AI都可以攻击扣血，新增hero4动画，完善普攻命中积攒大招的相关程序 
- 6.8  李元特：弹窗实现，AI和玩家死亡实现，update功能增加
       王鹏：排名系统与击杀计算系统
- 6.9  李元特：完成游戏结束界面，增加音效，实现AI进入草丛可见或不可见，monster创建，血条和蓝条后置解决，新增MAP界面，AI人数选择
       王鹏：碰撞检测修改，bug修复，增加增益函数，Maplayer优化
       束赫：结合增益函数，实现AI和player对monster的攻击效果，改进heroScene
- 6.10 李元特：人物信息弹窗完成，游戏加载界面（增加游戏说明），写入无敌模式接口
       王鹏：调整英雄与怪兽技能数值的平衡性，升级bug修复：ai数组的创建修改为依赖玩家选择，清楚用户数据实现，增益功能的结算实现
       束赫：页面微调，进入game加载页面优化
- 6.11 王鹏：无敌模式实现，资源加载改动，文件删除，人物数据调整
       束赫：注释代码规范，人物攻速动画修改，细节修改
       李元特：细节修改，结束界面和地图界面优化


# 2	游戏设计
## 2.1 项目整体分工
- 王鹏：主要负责游戏所需大多数的class的交互、设计，及AI和AI寻路的相关实现，代码规范的主要制定；
- 李元特：主要负责游戏地图各方面功能的设计实现，程序界面设计，用户交互的实现和衔接，素材的搜集；
- 束赫：主要负责人物动画和玩家的交互，AI的部分实现，碰撞的实现，游戏部分页面的设计，素材的搜集。
- 虽然有各自的分工，对于函数的修改和完善是团队中每一个人的责任，很多功能的实现是共同的成果。


## 2.2 游戏整体架构设计
 -  游戏中的class主要分为两大种类，第一类是游戏的**各个场景以及游戏主体地图(Scene)**，第二类是在**地图上动态运行，与玩家进行交互的实体(Entity)**。
      
 -  **Scene文件夹**下根据不同的场景以及功能划分了不同种类，如与游戏运行相关的Game，与设置相关的Settings等。在各个小的分类下，放置了各个场景的.cpp与.h文件。各个场景通过函数相互切换，实现游戏场景的切换。通过场景内的功能以及与数据的交互，允许玩家做游戏的前置选择地图、选择角色，实现查看角色信息、玩家个人战绩等具体功能。
      
 -  **Entity文件夹**下根据不同的实体，划分了角色、武器、怪兽等种类。实体继承于精灵，使得实体有了精灵的属性，便于使用。在角色文件夹内，设计了角色的基础面板类(Panel)，用于存储、调用角色的基本信息，实现造成伤害、受到伤害、治疗、升级、增益等底层面板数值的结算。
        
 -  **角色类(Player)**内置面板类，以此为基础，通过函数实现角色的攻击，移动，转身，动画，碰撞检测，与血条、武器进行交互等具有角色属性的功能，是英雄、怪兽的基础类。在角色类下设置了四个英雄类(Hero1~4)，根据各个英雄的不同设定，具体设计、实现各个英雄的不同点，比如属性数值的初始化，升级的加成，动画的初始化与调用，根据素材调整血条、蓝条、武器等的具体相对位置。

 -  **怪兽类**具有与角色类似的位置、血条、受伤、属性等设定，因此怪兽类(Monster)继承自角色类， 一是使得怪兽的模式与角色类似，便于编写程序时使用相似的初始化、调用方式等，其次在一些函数中，比如攻击函数，因为怪兽与英雄同样继承自角色，使得无需写多份类似代码，可以直接使用现有函数。这也符合我们将怪兽与英雄视为相似行为模式的实体的构想。在怪兽类下设置三个具体怪兽，分别为陆生怪兽，水生怪兽，荒漠怪兽，分别具有不同的血量等属性，同时击杀的时候会给玩家提供不同的增益属性。
        
 -  实体类下设一个**武器类**。武器类的作用是用于碰撞检测以及伤害的结算。当角色发动攻击时，角色的面板根据攻击力、攻击倍率等结算本次造成的伤害并传递给当前角色，通过角色将伤害传给武器类，随后角色调用武器类进行碰撞检测，武器类将伤害传给被命中角色。被命中角色在接收到伤害后，通过防御力对伤害进行减免，将减免后的伤害传给面板以作用在血量上，以此结算最终的伤害，这就是一次完整的攻击流程。
       
 -  一个完整的角色包括英雄类、武器类、血条类、蓝条类、等级类等，以及方向、击杀数等参数。为了便于统一管理，在实体下设一个**人物类**，对角色所需的所有类与参数统一管理。同理，在实体类下设一个怪兽类以对怪兽所需的类进行统一管理。这方便了通过动态数组对角色进行管理，也便于程序中调用。


## 2.3 实现的功能点
### 2.3.1 人物操控
  -   人物操控利用**keyboardListener**监听，每0.05秒调用update函数对按键进行判断， 用**std::map<cocos2d::EventKeyboard::KeyCode, bool> keyMap**在**onKeyPressed**函数中记录按下的按键并在update函数中根据keyMap实现人物的位移，预设为每次调用update函数实现人物4像素位移的改变。在**player类**的**panel面板类**中设置了**playerstates**的枚举，包括正常、攻击、移动、大招、死亡五种状态，在调用人物动画时首先检测状态，防止精灵的Action的冲突，更好地获知精灵在程序中时刻的状态。
 -    人物的攻击实现包括对触摸事件的监听，以及在**onTouchBegan**和**onTouchEnded**中对人物攻击相关函数的调用。
       
### 2.3.2 毒气圈（安全区）
   -  先制作一份周围一圈有毒气，其余地方为透明的安全区矩阵素材，设置素材大小为地图的1.1倍。 写一个**update**函数进行判断玩家或是AI有无处于安全区内，若在安全区外部，进行实时扣血处理。同时，在关于毒气的update函数里，通过地图的遍历，找到处于安全区外的坐标，每隔一定的距离， 进行毒气的生成，而已生成过毒气的坐标设置一个flag值，不在下一次遍历的时候生成。
      
### 2.3.3 AI自动寻路 
  -  AI自动寻路利用更新函数**updateAIMove**和**updateAIMoveOne**函数实现。前者每隔一定时间对各个AI进行遍历，并调用后者。**updateAIMoveOne**函数由键盘操控函数改写而成，加上对安全区的碰撞，用随机数除以60的余数小于等于3作为人物转向的条件，即让人物的转向概率为1/20，尽可能模拟真实的寻路场景。
   
### 2.3.4 碰撞和攻击
   - 在**人物类class**设计的过程中，即把人物和武器(weapon)捆绑在一起，所谓weapon指跟随人物移动的攻击范围矩阵，当人物的攻击范围矩阵碰撞到其他人物或者怪物的时候，发动攻击就会执行**launchAnAttack**函数，即进行目标扣血和自我回蓝的过程。在AI中，这一函数在**updateAIAttack**函数中执行，更新函数每隔一定事件对全体AI进行遍历，并对于每一个AI进行除自身包括玩家的所有英雄的二次遍历，查找碰撞成功的对象，进行碰撞的后续操作。
 

## 2.4 项目技术难点
### 2.3.1 动作衔接问题
- 可能是cocos引擎自身机制的问题，人物无法实现两个Action的连续进行，即使利用stopAllAction，也会使后一个动作直接覆盖前一个动作。为了实现比如点击鼠标一次使得人物发起一次攻击动画后直接进入站立状态，采用**update2**函数，并利用**scheduleOnce**延时调用一次该函数，保证在攻击动画播放完成后如果无其他操作直接播放站立动画。

### 2.3.2 动画冲突问题
- 由于上述**sheduleOnce**的调用，若没有在update2中对是否执行站立动画的判断，若攻击后直接进行移动操作，可能会发生移动动画和站立动画的冲突。解决这个问题可以设置bool型变量，用来表示是否执行站立动画。当人物处于移动状态时bool型设置为flase。这种设置bool型变量的方法也用在其他动画衔接处理的问题上。

### 2.3.3 人物管理
 - 由于本项目要实现四种英雄，保证玩家在四种英雄中的切换，同时要实现对player和AI的统一遍历。为方便管理，设计了**Character结构体**，下面是Character的部分数据。包括操控的人物player，武器、血条、蓝条、等级显示等，方便人物相关数据的统一处理。设置Player类作为四种Hero类的基类，并使函数参数均为Player类保证四种英雄都可以使用这些函数。
 - 下面是Character结构体的部分代码。
 
           struct Character
         {
             Player* _player;
             Weapon* _weapon;
             Slider* _healthBar;
             Slider* _magicBar;
             cocos2d::Label* _levelText;
             ……
         };
     
         


## 2.4 游戏功能实现
### 2.4.1 基础功能
* [x] 游戏加载界面
* [x] 游戏开始界面
* [x] 游戏背景音乐、音量控制
* [x] 游戏暂停及恢复功能
* [x] 设计两幅荒野决斗地图，添加三种不同类型的怪兽（能量宝箱）
* [x] 能量可给英雄增加生命值和伤害
* [x] 设计四种游戏英雄（Winston，Wrderly，Pearl，Soren）
* [x] 不同英雄的普通攻击和超级技能不同，对敌人普攻可以积攒大招
* [x] 支持创建房间，加入AI（MAP界面）
* [x] 键盘控制人物走动操作，鼠标控制人物进行普通攻击和超级技能
* [x] 随时间流逝，地图边缘出现毒圈
* [x] 最终的存活玩家为吃鸡者
* [x] 不同名词玩家的奖杯数量奖励不同

### 2.4.2 加分功能（亮点）
* [x] 项目目录结构良好、清晰，**代码格式，文件命名，变量命名**等规范，比较注重**细节**
* [x] 丰富多彩的**音效**（毒圈缩圈，技能攻击，命中敌人，击杀敌人，升级......）
* [x] 界面**精致**，具有细致的游戏介绍说明；还原度较高的各类素材（游戏较为**美观**）
* [x] 增加贯穿游戏的**弹窗**功能
* [x] 原游戏的宝箱进一步设置成了**三类怪兽**，不同的怪兽有**不同的血量**，同时有的类型的怪兽会给予**英雄攻击/防御Buff**
* [x] **用户排行榜系统**（总奖杯数、冠军数、总局数…）
* [x] 用户得以自行**清除数据**（信息重置）
* [x] 新加 **“地形战”** 模式地图
* [x] 增加 **无敌模式** 与经典模式
* [x] 玩家可以**自己选择NPC人数**
* [x] 游戏地图实现**传送阵**功能
* [x] 游戏地图实现**树丛英雄隐身**功能
* [x] NPC**寻找目标，攻击其他NPC（或玩家），躲避毒圈，攻击怪兽**
* [x] 游戏设计中存在较多**小细节**（彩蛋），欢迎玩家挖掘~

### 2.4.3 C++ 11 新特性
* [x] **初始化列表**
* [x] **类型推断（auto）**
* [x] **Lambda表达式**
* [x] **基于范围的for循环**


# 3 项目运行截图
## 3.1 游戏介绍 ![游戏介绍 ](https://img-blog.csdnimg.cn/a575c9fbc8c24c17b64361cd22af9015.png#pic_center)


## 3.2 地图界面（包括地图选择，NPC数量选择，游戏模式选择）
![地图界面](https://img-blog.csdnimg.cn/571291296f404239bc0bc4654ce9c602.png#pic_center)

## 3.3 怪兽、英雄介绍弹窗
![怪兽、英雄介绍弹窗](https://img-blog.csdnimg.cn/7fb33958c1f241b9a4bad2ce83c4d7f4.png#pic_center)


## 3.4 游戏运行界面
![游戏运行界面](https://img-blog.csdnimg.cn/8e0edb73d7d14452a8df09debd4238f1.png#pic_center)






